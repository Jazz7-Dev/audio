<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Audio Sound Analyzer | AI-Powered Audio Classification</title>
    <meta name="description" content="Upload audio or video files for AI-powered sound classification and analysis. Supports WAV, MP3, MP4, FLAC, OGG, M4A formats.">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;600;700;800&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
      *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
      
      :root {
        --bg-primary: #0a0a1a;
        --bg-secondary: #12122a;
        --glass-bg: rgba(255, 255, 255, 0.03);
        --glass-border: rgba(255, 255, 255, 0.08);
        --glass-border-hover: rgba(255, 255, 255, 0.15);
        --text-primary: #ffffff;
        --text-secondary: rgba(255, 255, 255, 0.6);
        --text-muted: rgba(255, 255, 255, 0.4);
        --accent-cyan: #00d9ff;
        --accent-purple: #a855f7;
        --accent-pink: #ec4899;
        --accent-gradient: linear-gradient(135deg, var(--accent-cyan), var(--accent-purple), var(--accent-pink));
        --glow-cyan: 0 0 30px rgba(0, 217, 255, 0.3);
        --glow-purple: 0 0 30px rgba(168, 85, 247, 0.3);
      }

      body {
        font-family: 'Inter', system-ui, -apple-system, sans-serif;
        background: var(--bg-primary);
        min-height: 100vh;
        color: var(--text-primary);
        overflow-x: hidden;
      }

      /* Animated gradient background */
      .bg-gradient {
        position: fixed;
        inset: 0;
        background: 
          radial-gradient(ellipse 80% 50% at 20% 40%, rgba(0, 217, 255, 0.15), transparent),
          radial-gradient(ellipse 60% 40% at 80% 60%, rgba(168, 85, 247, 0.12), transparent),
          radial-gradient(ellipse 50% 30% at 50% 80%, rgba(236, 72, 153, 0.1), transparent),
          var(--bg-primary);
        z-index: -2;
      }

      /* Floating particles */
      .particles {
        position: fixed;
        inset: 0;
        z-index: -1;
        overflow: hidden;
      }

      .particle {
        position: absolute;
        width: 4px;
        height: 4px;
        background: var(--accent-cyan);
        border-radius: 50%;
        opacity: 0.3;
        animation: float 15s infinite ease-in-out;
      }

      .particle:nth-child(2) { left: 20%; animation-delay: -2s; background: var(--accent-purple); }
      .particle:nth-child(3) { left: 40%; animation-delay: -4s; }
      .particle:nth-child(4) { left: 60%; animation-delay: -6s; background: var(--accent-pink); }
      .particle:nth-child(5) { left: 80%; animation-delay: -8s; }
      .particle:nth-child(6) { left: 90%; animation-delay: -10s; background: var(--accent-purple); }

      @keyframes float {
        0%, 100% { transform: translateY(100vh) scale(0); opacity: 0; }
        10% { opacity: 0.3; }
        90% { opacity: 0.3; }
        100% { transform: translateY(-10vh) scale(1); opacity: 0; }
      }

      .container {
        max-width: 720px;
        margin: 0 auto;
        padding: 40px 24px;
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        justify-content: center;
      }

      /* Header */
      .header {
        text-align: center;
        margin-bottom: 48px;
      }

      .logo {
        display: inline-flex;
        align-items: center;
        gap: 12px;
        margin-bottom: 16px;
      }

      .logo-icon {
        width: 48px;
        height: 48px;
        background: var(--accent-gradient);
        border-radius: 14px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 24px;
        box-shadow: var(--glow-purple);
      }

      h1 {
        font-family: 'Outfit', sans-serif;
        font-size: clamp(28px, 5vw, 40px);
        font-weight: 700;
        background: var(--accent-gradient);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }

      .subtitle {
        color: var(--text-secondary);
        font-size: 16px;
        margin-top: 8px;
      }

      /* Sound wave animation */
      .sound-wave {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 4px;
        height: 40px;
        margin: 24px 0;
      }

      .wave-bar {
        width: 4px;
        background: var(--accent-gradient);
        border-radius: 2px;
        animation: wave 1.2s ease-in-out infinite;
      }

      .wave-bar:nth-child(1) { height: 20px; animation-delay: 0s; }
      .wave-bar:nth-child(2) { height: 35px; animation-delay: 0.1s; }
      .wave-bar:nth-child(3) { height: 25px; animation-delay: 0.2s; }
      .wave-bar:nth-child(4) { height: 40px; animation-delay: 0.3s; }
      .wave-bar:nth-child(5) { height: 30px; animation-delay: 0.4s; }
      .wave-bar:nth-child(6) { height: 40px; animation-delay: 0.5s; }
      .wave-bar:nth-child(7) { height: 25px; animation-delay: 0.6s; }
      .wave-bar:nth-child(8) { height: 35px; animation-delay: 0.7s; }
      .wave-bar:nth-child(9) { height: 20px; animation-delay: 0.8s; }

      @keyframes wave {
        0%, 100% { transform: scaleY(0.5); opacity: 0.5; }
        50% { transform: scaleY(1); opacity: 1; }
      }

      /* Glass card */
      .glass-card {
        background: var(--glass-bg);
        border: 1px solid var(--glass-border);
        border-radius: 24px;
        padding: 32px;
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        position: relative;
        overflow: hidden;
      }

      .glass-card::before {
        content: '';
        position: absolute;
        inset: 0;
        border-radius: 24px;
        padding: 1px;
        background: linear-gradient(135deg, rgba(255,255,255,0.1), transparent, rgba(255,255,255,0.05));
        -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
        -webkit-mask-composite: xor;
        mask-composite: exclude;
        pointer-events: none;
      }

      /* Error message */
      .error-msg {
        background: rgba(239, 68, 68, 0.1);
        border: 1px solid rgba(239, 68, 68, 0.2);
        color: #fca5a5;
        padding: 12px 16px;
        border-radius: 12px;
        margin-bottom: 20px;
        font-size: 14px;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      /* Drop zone */
      .drop-zone {
        border: 2px dashed var(--glass-border);
        border-radius: 16px;
        padding: 40px 24px;
        text-align: center;
        cursor: pointer;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
      }

      .drop-zone:hover, .drop-zone.hover {
        border-color: var(--accent-cyan);
        background: rgba(0, 217, 255, 0.05);
        box-shadow: inset 0 0 30px rgba(0, 217, 255, 0.1);
      }

      .drop-zone.hover {
        transform: scale(1.02);
      }

      .upload-icon {
        width: 64px;
        height: 64px;
        margin: 0 auto 20px;
        background: var(--accent-gradient);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 28px;
        animation: pulse 2s ease-in-out infinite;
        box-shadow: var(--glow-cyan);
      }

      @keyframes pulse {
        0%, 100% { transform: scale(1); box-shadow: var(--glow-cyan); }
        50% { transform: scale(1.05); box-shadow: 0 0 50px rgba(0, 217, 255, 0.5); }
      }

      .drop-zone h3 {
        font-family: 'Outfit', sans-serif;
        font-size: 20px;
        font-weight: 600;
        margin-bottom: 8px;
        color: var(--text-primary);
      }

      .drop-zone p {
        color: var(--text-muted);
        font-size: 14px;
      }

      .file-types {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 8px;
        margin-top: 16px;
      }

      .file-type {
        background: rgba(255, 255, 255, 0.05);
        padding: 4px 10px;
        border-radius: 6px;
        font-size: 12px;
        color: var(--text-secondary);
        font-weight: 500;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      input[type="file"] { display: none; }

      /* Button */
      .btn-primary {
        width: 100%;
        margin-top: 24px;
        padding: 16px 32px;
        font-family: 'Outfit', sans-serif;
        font-size: 16px;
        font-weight: 600;
        color: var(--bg-primary);
        background: var(--accent-gradient);
        border: none;
        border-radius: 12px;
        cursor: pointer;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
      }

      .btn-primary:hover:not(:disabled) {
        transform: translateY(-2px);
        box-shadow: 0 10px 40px rgba(0, 217, 255, 0.3);
      }

      .btn-primary:disabled {
        opacity: 0.6;
        cursor: not-allowed;
      }

      .btn-primary::before {
        content: '';
        position: absolute;
        inset: 0;
        background: linear-gradient(135deg, rgba(255,255,255,0.2), transparent);
        opacity: 0;
        transition: opacity 0.3s;
      }

      .btn-primary:hover::before { opacity: 1; }

      /* Status */
      .status {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 12px;
        margin-top: 20px;
        color: var(--text-secondary);
        font-size: 14px;
      }

      .spinner {
        width: 20px;
        height: 20px;
        border: 2px solid var(--glass-border);
        border-top-color: var(--accent-cyan);
        border-radius: 50%;
        animation: spin 0.8s linear infinite;
      }

      @keyframes spin { to { transform: rotate(360deg); } }

      /* Audio preview */
      .audio-preview {
        margin-top: 20px;
      }

      .audio-preview audio, .audio-preview video {
        width: 100%;
        border-radius: 12px;
        outline: none;
      }

      .file-selected {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 12px 16px;
        background: rgba(0, 217, 255, 0.1);
        border: 1px solid rgba(0, 217, 255, 0.2);
        border-radius: 12px;
        margin-top: 16px;
      }

      .file-selected-icon {
        font-size: 20px;
      }

      .file-selected-name {
        flex: 1;
        font-size: 14px;
        color: var(--text-primary);
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }

      .file-selected-clear {
        background: none;
        border: none;
        color: var(--text-muted);
        cursor: pointer;
        font-size: 18px;
        padding: 4px;
        transition: color 0.2s;
      }

      .file-selected-clear:hover { color: var(--accent-pink); }

      /* Results section */
      .results-section {
        margin-top: 32px;
        animation: fadeInUp 0.5s ease;
      }

      @keyframes fadeInUp {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
      }

      .results-header {
        display: flex;
        align-items: center;
        gap: 12px;
        margin-bottom: 20px;
      }

      .results-header h2 {
        font-family: 'Outfit', sans-serif;
        font-size: 22px;
        font-weight: 600;
      }

      .result-item {
        background: var(--glass-bg);
        border: 1px solid var(--glass-border);
        border-radius: 12px;
        padding: 16px;
        margin-bottom: 12px;
        display: flex;
        align-items: center;
        gap: 16px;
        transition: all 0.3s ease;
        animation: fadeInUp 0.4s ease backwards;
      }

      .result-item:hover {
        border-color: var(--glass-border-hover);
        transform: translateX(4px);
      }

      .result-item.top {
        background: linear-gradient(135deg, rgba(0, 217, 255, 0.1), rgba(168, 85, 247, 0.1));
        border-color: rgba(0, 217, 255, 0.3);
      }

      .result-rank {
        width: 36px;
        height: 36px;
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-family: 'Outfit', sans-serif;
        font-weight: 700;
        font-size: 14px;
        background: rgba(255, 255, 255, 0.05);
        color: var(--text-secondary);
      }

      .result-item.top .result-rank {
        background: var(--accent-gradient);
        color: var(--bg-primary);
        box-shadow: var(--glow-cyan);
      }

      .result-info { flex: 1; }

      .result-name {
        font-weight: 500;
        margin-bottom: 6px;
        text-transform: capitalize;
      }

      .result-bar-bg {
        height: 6px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 3px;
        overflow: hidden;
      }

      .result-bar {
        height: 100%;
        background: var(--accent-gradient);
        border-radius: 3px;
        transition: width 0.8s ease;
        box-shadow: 0 0 10px rgba(0, 217, 255, 0.5);
      }

      .result-value {
        font-family: 'Outfit', sans-serif;
        font-weight: 600;
        font-size: 18px;
        min-width: 70px;
        text-align: right;
        background: var(--accent-gradient);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }

      /* Footer */
      .footer {
        text-align: center;
        margin-top: 48px;
        color: var(--text-muted);
        font-size: 13px;
      }

      /* Responsive */
      @media (max-width: 640px) {
        .container { padding: 24px 16px; }
        .glass-card { padding: 24px 16px; }
        .drop-zone { padding: 32px 16px; }
        .upload-icon { width: 56px; height: 56px; font-size: 24px; }
        .result-item { flex-wrap: wrap; }
        .result-value { width: 100%; text-align: left; margin-top: 8px; }
      }
    </style>
  </head>
  <body>
    <div class="bg-gradient"></div>
    <div class="particles">
      <div class="particle"></div>
      <div class="particle"></div>
      <div class="particle"></div>
      <div class="particle"></div>
      <div class="particle"></div>
      <div class="particle"></div>
    </div>

    <div class="container">
      <header class="header">
        <div class="logo">
          <div class="logo-icon">üéµ</div>
        </div>
        <h1>Audio Sound Analyzer</h1>
        <p class="subtitle">AI-powered audio classification in seconds</p>
        
        <div class="sound-wave">
          <div class="wave-bar"></div>
          <div class="wave-bar"></div>
          <div class="wave-bar"></div>
          <div class="wave-bar"></div>
          <div class="wave-bar"></div>
          <div class="wave-bar"></div>
          <div class="wave-bar"></div>
          <div class="wave-bar"></div>
          <div class="wave-bar"></div>
        </div>
      </header>

      <main class="glass-card">
        {% if error %}
          <div class="error-msg">
            <span>‚ö†Ô∏è</span>
            <span>{{ error }}</span>
          </div>
        {% endif %}

        <form id="uploadForm" method="post" enctype="multipart/form-data">
          <label id="dropArea" class="drop-zone">
            <div class="upload-icon">üì§</div>
            <h3>Drop your file here</h3>
            <p>or click to browse your device</p>
            <div class="file-types">
              <span class="file-type">wav</span>
              <span class="file-type">mp3</span>
              <span class="file-type">mp4</span>
              <span class="file-type">flac</span>
              <span class="file-type">ogg</span>
              <span class="file-type">m4a</span>
            </div>
            <input id="fileInput" type="file" name="file" accept="audio/*,video/*">
          </label>

          <div id="fileInfo"></div>
          <div id="preview" class="audio-preview"></div>

          <button id="uploadBtn" class="btn-primary" type="submit">
            üöÄ Analyze Audio
          </button>
        </form>

        <div id="status" class="status"></div>
        <div id="results"></div>
      </main>

      <footer class="footer">
        Powered by YAMNet ‚Ä¢ TensorFlow Audio Classification
      </footer>
    </div>

    <script>
      const form = document.getElementById('uploadForm');
      const status = document.getElementById('status');
      const resultsContainer = document.getElementById('results');
      const dropArea = document.getElementById('dropArea');
      const fileInput = document.getElementById('fileInput');
      const uploadBtn = document.getElementById('uploadBtn');
      const preview = document.getElementById('preview');
      const fileInfo = document.getElementById('fileInfo');

      let selectedFile = null;

      function setProcessing(on) {
        uploadBtn.disabled = on;
        if (on) {
          status.innerHTML = '<span class="spinner"></span> Analyzing your audio...';
        } else {
          status.innerHTML = '';
        }
      }

      function formatFileSize(bytes) {
        if (bytes < 1024) return bytes + ' B';
        if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
        return (bytes / (1024 * 1024)).toFixed(1) + ' MB';
      }

      function showFileInfo(file) {
        fileInfo.innerHTML = `
          <div class="file-selected">
            <span class="file-selected-icon">üéµ</span>
            <span class="file-selected-name">${file.name} (${formatFileSize(file.size)})</span>
            <button type="button" class="file-selected-clear" onclick="clearFile()">‚úï</button>
          </div>
        `;
      }

      function clearFile() {
        selectedFile = null;
        fileInput.value = '';
        fileInfo.innerHTML = '';
        preview.innerHTML = '';
        resultsContainer.innerHTML = '';
      }

      // Drag & drop events
      ['dragenter', 'dragover'].forEach(evt => {
        dropArea.addEventListener(evt, e => {
          e.preventDefault();
          dropArea.classList.add('hover');
        });
      });

      ['dragleave', 'drop'].forEach(evt => {
        dropArea.addEventListener(evt, e => {
          e.preventDefault();
          dropArea.classList.remove('hover');
        });
      });

      dropArea.addEventListener('drop', e => {
        const file = e.dataTransfer.files[0];
        if (file) handleFileSelect(file);
      });

      dropArea.addEventListener('click', () => fileInput.click());
      fileInput.addEventListener('change', () => {
        if (fileInput.files[0]) handleFileSelect(fileInput.files[0]);
      });

      function handleFileSelect(file) {
        selectedFile = file;
        showFileInfo(file);
        preview.innerHTML = '';
        resultsContainer.innerHTML = '';

        const ext = file.name.split('.').pop().toLowerCase();
        if (['wav', 'mp3', 'ogg', 'm4a', 'flac'].includes(ext)) {
          const audio = document.createElement('audio');
          audio.controls = true;
          audio.src = URL.createObjectURL(file);
          preview.appendChild(audio);
        } else if (['mp4', 'mov', 'webm'].includes(ext)) {
          const video = document.createElement('video');
          video.controls = true;
          video.src = URL.createObjectURL(file);
          video.style.maxWidth = '100%';
          video.style.borderRadius = '12px';
          preview.appendChild(video);
        }

        // Update file input
        const dt = new DataTransfer();
        dt.items.add(file);
        fileInput.files = dt.files;
      }

      form.addEventListener('submit', async (e) => {
        e.preventDefault();
        resultsContainer.innerHTML = '';

        if (!fileInput.files.length) {
          status.innerHTML = '<span style="color: #fca5a5;">Please select a file first</span>';
          return;
        }

        const fd = new FormData();
        fd.append('file', fileInput.files[0]);
        setProcessing(true);

        try {
          const resp = await fetch('/analyze', { method: 'POST', body: fd });
          if (!resp.ok) {
            const err = await resp.json().catch(() => ({}));
            status.innerHTML = `<span style="color: #fca5a5;">${err.error || 'Analysis failed'}</span>`;
            setProcessing(false);
            return;
          }

          const data = await resp.json();
          const results = data.results || [];

          // Build results
          let html = `
            <div class="results-section">
              <div class="results-header">
                <span style="font-size: 24px;">üìä</span>
                <h2>Analysis Results</h2>
              </div>
          `;

          results.forEach((r, idx) => {
            const isTop = idx === 0;
            const delay = idx * 0.08;
            html += `
              <div class="result-item ${isTop ? 'top' : ''}" style="animation-delay: ${delay}s">
                <div class="result-rank">${isTop ? 'üèÜ' : idx + 1}</div>
                <div class="result-info">
                  <div class="result-name">${r.name}</div>
                  <div class="result-bar-bg">
                    <div class="result-bar" style="width: ${r.percentage}%"></div>
                  </div>
                </div>
                <div class="result-value">${r.percentage.toFixed(1)}%</div>
              </div>
            `;
          });

          html += '</div>';
          resultsContainer.innerHTML = html;

        } catch (err) {
          console.error(err);
          status.innerHTML = '<span style="color: #fca5a5;">Error analyzing file</span>';
        } finally {
          setProcessing(false);
        }
      });
    </script>
  </body>
</html>
